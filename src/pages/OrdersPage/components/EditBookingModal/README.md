# EditBookingModal

Модальное окно для редактирования заказа на странице заказов.

## Описание

Компонент предоставляет интерфейс для просмотра и редактирования информации о бронировании автомобиля. Включает отображение статуса заказа, информации об автомобиле, времени начала и окончания услуги, названия основной и дополнительной услуги, а также комментария к заказу.

## Реализованные функции

### 1. Заголовок
- Отображение текста «Запись»
- Отображение статуса заказа в виде цветного тега (AppTag):
  - `pending_confirmation` → желтый тег "Ожидает"
  - `confirmed` → синий тег "Подтвержден"
  - `completed` → зеленый тег "Выполнен"
  - `cancelled` → красный тег "Отменен"

### 2. Информация о машине
- Отображение изображения автомобиля (placeholder, т.к. `generated_image` не доступен в `BookingCarDto`)
- Модель автомобиля (марка + модель)
- Госномер и регион в формате "A000AA | 111"

### 3. Продолжительность
- Два селекта времени:
  - **Начало**: выбор времени от `startHour` до `endHour` с шагом 1 час
  - **Конец**: disabled, автоматически рассчитывается как начало + 1 час
- Разделитель между селектами (горизонтальная линия)

### 4. Поля формы
- **Название услуги**: поле AppInput с лейблом, отображает название основной услуги
- **Дополнительная услуга**: поле AppInput с лейблом, отображает название первой дополнительной услуги
- **Комментарий к заказу**: поле AppInput с лейблом и placeholder

### 5. Кнопка "Отменить"
- Красный текст (#E83046)
- При клике показывает подтверждение
- Отменяет заказ (изменяет статус на `cancelled`)
- После отмены вызывает callbacks `onUpdate()` и `onClose()`

## Props

```typescript
interface EditBookingModalProps {
  isOpen: boolean;          // Открыта ли модалка
  startHour: number;         // Начальный час для селекта времени
  endHour: number;           // Конечный час для селекта времени
  onClose: () => void;       // Callback при закрытии
  bookingUuid: string;       // UUID бронирования для загрузки данных
  onUpdate: () => void;      // Callback после успешного обновления
}
```

## Логика работы

### Загрузка данных
- При открытии модального окна (`isOpen=true`) автоматически загружаются данные бронирования через `bookingsStore.fetchBookingDetails(bookingUuid)`
- Показывается состояние загрузки "Загрузка..."
- При ошибке загрузки показывается сообщение "Не удалось загрузить данные заказа"

### Блокировка скролла
- При открытии модального окна блокируется скролл основной страницы
- При закрытии скролл восстанавливается

### Валидация
- Пока не реализована валидация полей формы
- Селект времени окончания disabled - можно редактировать только время начала

### Отмена заказа
- При клике на кнопку "Отменить" показывается стандартный `confirm` диалог
- После подтверждения вызывается `bookingsStore.updateBookingStatus(bookingUuid, 'cancelled')`
- При успешной отмене вызываются `onUpdate()` и `onClose()`

## Зависимости

- `AppInput` - компонент текстового инпута
- `AppTag` - компонент тега/бейджа для статуса
- `AppSingleSelect` - компонент селекта для выбора времени
- `BookingsStore` - MobX store для работы с бронированиями
- `ToastStore` - MobX store для показа уведомлений

## Использование

```typescript
import EditBookingModal from '@/pages/OrdersPage/components/EditBookingModal';

function OrdersPage() {
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [selectedBookingUuid, setSelectedBookingUuid] = useState('');

  const handleOpenModal = (uuid: string) => {
    setSelectedBookingUuid(uuid);
    setIsModalOpen(true);
  };

  const handleCloseModal = () => {
    setIsModalOpen(false);
  };

  const handleUpdate = () => {
    // Обновить список заказов
    bookingsStore.fetchBookings();
  };

  return (
    <>
      {/* ... */}
      <EditBookingModal
        isOpen={isModalOpen}
        startHour={9}
        endHour={18}
        onClose={handleCloseModal}
        bookingUuid={selectedBookingUuid}
        onUpdate={handleUpdate}
      />
    </>
  );
}
```

## Стилизация

Компонент использует CSS модуль `EditBookingModal.css` со следующими классами:

- `.edit-booking-modal-overlay` - затемненный фон модального окна
- `.edit-booking-modal` - контейнер модального окна
- `.edit-booking-modal__header` - заголовок с названием и тегом статуса
- `.edit-booking-modal__car-info` - блок с информацией об автомобиле
- `.edit-booking-modal__content` - основной контент с формой
- `.edit-booking-modal__footer` - футер с кнопкой отмены

Все стили соответствуют дизайн-системе проекта (шрифт Onest, цвета из палитры gray/*, радиусы скругления и т.д.)

## TODO / Улучшения

1. **Валидация полей**: добавить валидацию обязательных полей перед сохранением
2. **Обновление данных**: реализовать логику сохранения изменений (сейчас реализована только отмена заказа)
3. **Изображение автомобиля**: добавить отображение реального изображения, когда будет доступно `generated_image` в API
4. **Загрузка селектов услуг**: заменить текстовые инпуты на селекты с загрузкой списка доступных услуг
5. **Редактирование времени окончания**: сделать селект времени окончания редактируемым с проверкой, что конец > начала
6. **Кнопка сохранения**: добавить кнопку "Сохранить" для применения изменений (сейчас изменения не сохраняются)

## Storybook

Компонент имеет несколько stories для различных состояний:

- `Default` - модальное окно открыто со статусом "Ожидает"
- `Closed` - модальное окно закрыто
- `ConfirmedStatus` - модальное окно со статусом "Подтвержден"
- `CompletedStatus` - модальное окно со статусом "Выполнен"

Для правильной работы stories используются моки данных бронирования.
